# Phase 5 Testing Guide

## ğŸ“‹ Overview

This document provides instructions for testing the FlowNote MCP Server and Obsidian synchronization features implemented in Phase 5.

## ğŸ§ª Test Coverage

### **Integration Tests (`tests/integration/test_phase5_sync_flow.py`)**

1. **File Creation and Classification**
   - âœ… Obsidian íŒŒì¼ ìƒì„± â†’ FlowNote ë¶„ë¥˜ â†’ PARA í´ë” ì´ë™
   - âœ… `move_file_to_para` ë™ì‘ ê²€ì¦

2. **Conflict Detection**
   - âœ… 3-way ì¶©ëŒ ê°ì§€ (local vs remote vs last_synced)
   - âœ… `detect_conflict_3way` ë¡œì§ ê²€ì¦

3. **Conflict Resolution**
   - âœ… Rename ì „ëµ ì ìš©
   - âœ… ë°±ì—… íŒŒì¼ ìƒì„± í™•ì¸

4. **No-Conflict Scenarios**
   - âœ… ë¡œì»¬ë§Œ ë³€ê²½ ì‹œ ì¶©ëŒ ì—†ìŒ
   - âœ… ì›ê²©ë§Œ ë³€ê²½ ì‹œ ì¶©ëŒ ì—†ìŒ

## ğŸš€ Running Tests

### **All Phase 5 Tests**
```bash
python -m pytest tests/integration/test_phase5_sync_flow.py -v
```

### **Specific Test**
```bash
python -m pytest tests/integration/test_phase5_sync_flow.py::test_obsidian_file_creation_and_classification -v
```

### **With Coverage**
```bash
python -m pytest tests/integration/test_phase5_sync_flow.py --cov=backend/services --cov-report=html
```

## ğŸ”§ Claude Desktop Integration

### **Configuration File**

The `claude_desktop_config.json` file enables Claude Desktop to connect to the FlowNote MCP server.

**Setup Instructions:**

1. Copy the example configuration:
   ```bash
   cp claude_desktop_config.example.json claude_desktop_config.json
   ```

2. Edit `claude_desktop_config.json` with your actual paths:
   - Replace `/path/to/your/flownote-mvp` with your project directory
   - Replace `/path/to/your/ObsidianVault` with your Obsidian Vault path

**Example Configuration** (see `claude_desktop_config.example.json`):
```json
{
  "mcpServers": {
    "flownote": {
      "command": "python",
      "args": ["-m", "backend.mcp.server"],
      "cwd": "/path/to/your/flownote-mvp",
      "env": {
        "OBSIDIAN_VAULT_PATH": "/path/to/your/ObsidianVault",
        "OBSIDIAN_SYNC_ENABLED": "true",
        "OBSIDIAN_SYNC_INTERVAL": "300"
      }
    }
  }
}
```

### **Testing with Claude Desktop**

1. **Copy Configuration to Claude Desktop:**
   ```bash
   # macOS - Update paths in claude_desktop_config.json first!
   cp claude_desktop_config.json ~/Library/Application\ Support/Claude/claude_desktop_config.json
   ```

2. **Restart Claude Desktop**

3. **Test MCP Tools:**
   - Ask Claude: "ë‚´ ë…¸íŠ¸ì—ì„œ 'í”„ë¡œì íŠ¸' ê´€ë ¨ ë‚´ìš© ì°¾ì•„ì¤˜"
   - Verify that Claude uses the `search_notes` tool

4. **Test Classification:**
   - Ask Claude: "ì´ í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¥˜í•´ì¤˜: ì˜¤ëŠ˜ í”„ë¡œì íŠ¸ íšŒì˜ê°€ ìˆìŠµë‹ˆë‹¤."
   - Verify that Claude uses the `classify_content` tool

## ğŸ“Š Test Results

### **Latest Run (2025-12-23)**
```
============================= test session starts ==============================
platform darwin -- Python 3.11.10, pytest-8.3.0, pluggy-1.6.0
collected 4 items

tests/integration/test_phase5_sync_flow.py::test_obsidian_file_creation_and_classification PASSED [ 25%]
tests/integration/test_phase5_sync_flow.py::test_conflict_detection_and_rename_resolution PASSED [ 50%]
tests/integration/test_phase5_sync_flow.py::test_no_conflict_when_only_local_changed PASSED [ 75%]
tests/integration/test_phase5_sync_flow.py::test_no_conflict_when_only_remote_changed PASSED [100%]

========================= 4 passed, 1 warning in 0.61s =========================
```

### **Coverage**
- `backend/services/sync_service.py`: 74%
- `backend/services/obsidian_sync.py`: 50%
- `backend/services/conflict_resolution_service.py`: 65%
- `backend/services/ignore_manager.py`: 65%

## ğŸ¯ Manual Testing Scenarios

### **Scenario 1: File Creation and Auto-Classification**

1. Create a new file in Obsidian Vault:
   ```markdown
   # Project Meeting Notes
   
   Today's meeting discussed the new AI project.
   Deadline: Next week.
   ```

2. Verify:
   - File is classified as "Projects"
   - File is moved to `Projects/` folder
   - No duplicate files created

### **Scenario 2: Conflict Detection**

1. Modify a file locally (in Obsidian)
2. Modify the same file remotely (simulate)
3. Trigger sync
4. Verify:
   - Conflict is detected
   - Backup file is created (`filename_conflict_timestamp.md`)
   - Remote content is applied to original file

### **Scenario 3: MCP Server Connection**

1. Start MCP server:
   ```bash
   python -m backend.mcp.server
   ```

2. Verify server logs show:
   - Tools registered: `classify_content`, `search_notes`, `get_automation_stats`
   - Resources registered: `flownote://para/projects`, `flownote://dashboard/summary`

## ğŸ› Troubleshooting

### **Tests Failing**

1. **Import Errors:**
   ```bash
   # Ensure virtual environment is activated
   pyenv activate myenv
   
   # Verify Python version
   python --version  # Should be 3.11.x
   ```

2. **Fixture Errors:**
   ```bash
   # Check conftest.py is present
   ls tests/conftest.py
   ```

3. **Async Errors:**
   ```bash
   # Ensure pytest-asyncio is installed
   pip install pytest-asyncio
   ```

### **Claude Desktop Not Connecting**

1. Check configuration file location
2. Verify Python path in config
3. Check Claude Desktop logs
4. Restart Claude Desktop

## ğŸ“ Next Steps

- [ ] Add E2E tests with real Obsidian Vault
- [ ] Add performance tests for large file sets
- [ ] Add stress tests for conflict resolution
- [ ] Add MCP protocol compliance tests

## ğŸ”— Related Documentation

- [v5.0 Phase 5 Detail](../temp/2025_12/12_17/files/v2/v5.0_phase5_detail.md)
- [MCP Server Implementation](../backend/mcp/server.py)
- [Obsidian Sync Service](../backend/services/obsidian_sync.py)
- [Conflict Resolution Service](../backend/services/conflict_resolution_service.py)
