# Feature Spec: Markdown Export

**작성일:** 2025.10.23  
**버전:** 1.0 (MVP)  
**담당:** Jay Lee  
**우선순위:** P0 (MVP 필수)

---

## 1. 개요

### 1.1 목적
프롬프트 템플릿 실행 결과를 Markdown 파일로 내보내어 저장하고 공유할 수 있게 한다.

### 1.2 범위
- **MVP:** 로컬 파일 저장, 파일명 자동 생성, UTF-8 인코딩
- **v1.1:** Notion 자동 업로드
- **v1.2:** 다양한 형식 (PDF, DOCX)

---

## 2. 사용자 스토리

### 2.1 As a User
```
AS a FlowNote 사용자
I WANT TO 검색 및 변환 결과를 파일로 저장하고
SO THAT 나중에 다시 보거나 다른 곳에서 활용할 수 있다
```

### 2.2 시나리오
```
GIVEN 프롬프트 템플릿 실행 결과가 있을 때
WHEN "다운로드" 버튼을 클릭하면
THEN Markdown 파일이 data/exports/ 폴더에 저장되고
AND "저장 완료!" 메시지가 표시된다
```

---

## 3. 기능 요구사항

### 3.1 파일 내보내기 (MVP)

**입력:**
- 내용 (Markdown 텍스트)
- 템플릿 종류 (summary, qa, keywords)
- (선택) 사용자 지정 파일명

**처리:**
1. 파일명 자동 생성 (템플릿_날짜시간.md)
2. UTF-8 인코딩으로 저장
3. data/exports/ 폴더에 저장
4. 메타데이터 기록

**출력:**
- 저장 경로 표시
- 다운로드 버튼 (Streamlit)

---

### 3.2 파일명 규칙

**기본 형식:**
```
{template}_{YYYY-MM-DD}_{HH-MM-SS}.md
```

**예시:**
```
summary_2025-10-23_15-30-45.md
qa_2025-10-23_15-31-12.md
keywords_2025-10-23_15-32-00.md
```

---

### 3.3 파일 구조

**Markdown 파일 구조:**
```
# FlowNote Export: {템플릿 이름}

**생성일:** 2025-10-23 15:30:45  
**템플릿:** 요약  
**검색어:** 프로젝트 기획

***

## 결과

{템플릿 실행 결과 내용}

***

## 원본 검색 결과

1. **파일:** chatgpt_2025-10-23.md  
   **내용:** [내용 미리보기...]

2. **파일:** claude_2025-10-22.md  
   **내용:** [내용 미리보기...]

...

***

*Generated by FlowNote MVP v1.0*
```

---

## 4. UI 설계

### 4.1 Streamlit 컴포넌트
```python
# 내보내기 섹션
with st.expander("📥 결과 내보내기", expanded=True):
    # 파일명 입력 (선택)
    custom_filename = st.text_input(
        "파일명 (선택)",
        placeholder="기본: {template}_{date}_{time}.md"
    )
    
    # 다운로드 버튼
    timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    filename = custom_filename or f"{template}_{timestamp}.md"
    
    st.download_button(
        label="📥 Markdown 다운로드",
        data=result_markdown,
        file_name=filename,
        mime="text/markdown"
    )
    
    # 로컬 저장 버튼
    if st.button("💾 로컬 저장"):
        save_to_local(result_markdown, filename)
        st.success(f"✅ 저장 완료: data/exports/{filename}")
```

---

## 5. 데이터 모델

### 5.1 Export 메타데이터
```bash
{
    "export_id": "exp_20251023_153045",
    "template": "summary",
    "search_query": "프로젝트 기획",
    "filename": "summary_2025-10-23_15-30-45.md",
    "filepath": "data/exports/summary_2025-10-23_15-30-45.md",
    "created_at": "2025-10-23T15:30:45",
    "size_bytes": 1234,
    "source_files": [
        "chatgpt_2025-10-23.md",
        "claude_2025-10-22.md"
    ]
}
```

---

## 6. 비기능 요구사항

### 6.1 성능
- 파일 저장 시간: 1초 이내
- 최대 파일 크기: 10MB

### 6.2 인코딩
- UTF-8 with BOM (Windows 호환)
- 한글 완벽 지원

### 6.3 저장 공간
- 최대 저장 파일 수: 1000개 (MVP)
- 자동 정리: 90일 이상 파일 삭제 (v1.1)

---

## 7. 에러 처리

### 7.1 에러 케이스
| 에러 | 원인 | 처리 |
|------|------|------|
| 저장 공간 부족 | 디스크 풀 | "저장 공간이 부족합니다" |
| 파일명 충돌 | 동일 파일명 존재 | 자동으로 `_1` 추가 |
| 쓰기 권한 없음 | 폴더 권한 문제 | "폴더 권한을 확인하세요" |
| 인코딩 실패 | 특수 문자 | UTF-8로 강제 변환 |

---

## 8. 테스트 케이스

### 8.1 저장 테스트
```
TC-001: 기본 파일명 저장
- Input: 요약 결과
- Expected: summary_2025-10-23_15-30-45.md 생성

TC-002: 사용자 지정 파일명
- Input: "내 요약.md"
- Expected: 내 요약.md 생성

TC-003: 한글 파일명
- Input: "프로젝트_요약.md"
- Expected: 정상 저장, UTF-8 인코딩
```

### 8.2 예외 테스트
```
TC-004: 파일명 충돌
- Input: 기존과 동일 파일명
- Expected: 자동으로 _1 추가

TC-005: 큰 파일
- Input: 15MB 결과
- Expected: "파일이 너무 큽니다" 경고
```

---

## 9. 구현 우선순위

### P0 (MVP, 10.27-28)
- [x] Markdown 파일 저장
- [x] 파일명 자동 생성
- [x] UTF-8 인코딩
- [x] Streamlit 다운로드 버튼

### P1 (v1.1, 11.12-14)
- [ ] Notion 자동 업로드
- [ ] 메타데이터 관리
- [ ] 파일 목록 UI

### P2 (v1.2)
- [ ] PDF 변환
- [ ] DOCX 변환
- [ ] 자동 정리 (90일)

---

## 10. 참고사항

### 10.1 관련 Spec
- `prompt-templates.md` - 결과 생성
- `file-upload.md` - 업로드와 대칭

### 10.2 기술 스택
- Python: `pathlib`, `open()`, `codecs`
- Streamlit: `st.download_button()`
- 인코딩: UTF-8 with BOM

### 10.3 파일 관리
- 폴더: `data/exports/`
- 백업: Time Machine (자동)
- 정리: 수동 (MVP), 자동 (v1.1)

---

**End of Spec**
