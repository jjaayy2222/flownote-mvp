# Feature Spec: File Upload

**작성일:** 2025.10.23  
**버전:** 1.0 (MVP)  
**담당:** Jay Lee  
**우선순위:** P0 (MVP 필수)

---

## 1. 개요

### 1.1 목적
사용자가 AI 대화 파일(ChatGPT, Claude, Perplexity export)을 FlowNote에 업로드하여 저장 및 처리할 수 있게 한다.

### 1.2 범위
- **MVP:** Markdown(.md), 텍스트(.txt) 파일 업로드
- **v1.1:** JSON, PDF 추가
- **v1.2:** 음성, 이미지 추가

---

## 2. 사용자 스토리

### 2.1 As a User
```
AS a FlowNote 사용자
I WANT TO AI 대화 파일을 업로드하고
SO THAT 나중에 검색하고 찾아볼 수 있다
```

### 2.2 시나리오
```
GIVEN Jay가 FlowNote를 실행했을 때
WHEN 파일 업로드 버튼을 클릭하고
AND .md 또는 .txt 파일을 선택하면
THEN 파일이 data/uploads/ 폴더에 저장되고
AND "업로드 완료!" 메시지가 표시된다
```

---

## 3. 기능 요구사항

### 3.1 파일 업로드 (MVP)

**입력:**
- 파일 형식: `.md`, `.txt`
- 파일 크기: 최대 10MB
- 다중 업로드: 지원 (한 번에 최대 5개)

**처리:**
1. 파일 검증 (형식, 크기)
2. 파일명 중복 체크 (중복 시 `_1`, `_2` 추가)
3. `data/uploads/` 폴더에 저장
4. 메타데이터 생성 (파일명, 업로드 시간, 크기)

**출력:**
- 성공 메시지: "✅ {파일명} 업로드 완료!"
- 실패 메시지: "❌ {파일명} 업로드 실패: {이유}"

---

### 3.2 파일 목록 표시

**기능:**
- 업로드된 파일 목록을 테이블로 표시
- 컬럼: 파일명, 업로드 시간, 크기, 삭제 버튼

**정렬:**
- 기본: 업로드 시간 (최신순)
- 옵션: 파일명 (가나다순)

---

### 3.3 파일 삭제

**기능:**
- 선택한 파일 삭제
- 삭제 전 확인 다이얼로그
- 삭제 후 FAISS 인덱스도 함께 제거

---

## 4. 비기능 요구사항

### 4.1 성능
- 파일 업로드 시간: 1MB당 1초 이내
- 파일 목록 로딩: 100개 기준 1초 이내

### 4.2 보안
- 허용된 확장자만 업로드 (화이트리스트)
- 파일 내용 스캔 (악성 코드 차단)

### 4.3 사용성
- 드래그 앤 드롭 지원 (v1.1)
- 업로드 진행률 표시

---

## 5. UI 설계

### 5.1 Streamlit 컴포넌트
```
# 파일 업로드
uploaded_files = st.file_uploader(
    "AI 대화 파일 업로드",
    type=["md", "txt"],
    accept_multiple_files=True,
    help="최대 5개, 각 10MB 이하"
)

# 파일 목록 테이블
st.dataframe(
    df,
    columns=["파일명", "업로드 시간", "크기", "삭제"],
    use_container_width=True
)
```

---

## 6. 데이터 모델

### 6.1 파일 메타데이터
```bash
{
    "filename": "chatgpt_2025-10-23.md",
    "filepath": "data/uploads/chatgpt_2025-10-23.md",
    "uploaded_at": "2025-10-23T14:30:00",
    "size_bytes": 15234,
    "size_human": "14.9 KB",
    "file_type": "markdown",
    "status": "uploaded"  # uploaded, processing, indexed, error
}
```

---

## 7. 에러 처리

### 7.1 에러 케이스
| 에러 | 원인 | 처리 |
|------|------|------|
| 파일 형식 오류 | .md, .txt 외 | "지원되지 않는 파일 형식입니다" |
| 파일 크기 초과 | 10MB 초과 | "파일 크기는 10MB 이하여야 합니다" |
| 중복 파일명 | 같은 이름 존재 | 자동으로 `_1` 추가 |
| 저장 공간 부족 | 디스크 풀 | "저장 공간이 부족합니다" |

---

## 8. 테스트 케이스

### 8.1 정상 케이스
```
TC-001: 단일 .md 파일 업로드
- Input: 1MB .md 파일
- Expected: 업로드 성공, 파일 목록에 표시

TC-002: 다중 파일 업로드
- Input: 3개 .txt 파일
- Expected: 모두 업로드 성공

TC-003: 중복 파일명
- Input: 동일한 파일명 2회 업로드
- Expected: 두 번째 파일 `_1` 자동 추가
```

### 8.2 예외 케이스
```
TC-004: 지원되지 않는 형식
- Input: .pdf 파일
- Expected: 에러 메시지 표시

TC-005: 크기 초과
- Input: 15MB 파일
- Expected: "파일 크기 초과" 에러
```

---

## 9. 구현 우선순위

### P0 (MVP, 10.24-25)
- [x] 파일 업로드 (단일)
- [x] .md, .txt 지원
- [x] 파일 목록 표시
- [x] 기본 에러 처리

### P1 (v1.1, 11.5-9)
- [ ] 다중 파일 업로드
- [ ] 드래그 앤 드롭
- [ ] JSON, PDF 지원

### P2 (v1.2)
- [ ] 음성, 이미지 지원
- [ ] 업로드 진행률 표시

---

## 10. 참고사항

### 10.1 관련 Spec
- `faiss-search.md` - 업로드된 파일 인덱싱
- `markdown-export.md` - 파일 내용 읽기

### 10.2 기술 스택
- Streamlit: `st.file_uploader()`
- Python: `pathlib`, `shutil`
- 인코딩: UTF-8 (한글 지원)

---

**End of Spec**